

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Printech ERP - All-in-One</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        /* --- GLOBAL CSS --- */
        :root {
            --primary-gradient: linear-gradient(to right, #07AFC0, #1aa853);
            --sidebar-gradient: linear-gradient(#34caca, #1aa853);
            --text-gray: #333;
        }

        body {
            margin: 0; font-family: 'Tahoma', sans-serif; background: #fff;
            background-image: url('bgdot.jpeg'); display: flex; height: 100vh; overflow: hidden;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 230px; height: 100vh; background: var(--sidebar-gradient);
            padding-top: 30px; box-shadow: 0 0 15px rgba(0,0,0,0.15); flex-shrink: 0;
        }
        .ptimg {
            margin: 0 30px; width: 70%; border-radius: 12px; background: #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.2); padding: 10px; display: flex; justify-content: center;
        }
        .ptimg img { width: 100px; height: auto; }
        .sidebar a {
            display: block; padding: 12px 20px; margin: 10px 15px; text-decoration: none;
            color: white; font-size: 16px; border-radius: 20px; transition: 0.3s; cursor: pointer;
        }
        .sidebar a:hover, .sidebar a.active { background: rgba(255,255,255,0.3); }
        .sidebar button.logout-btn {
            display: block; width: 85%; padding: 12px; margin: 40px auto;
            background: white; color: #26bfa3; border-radius: 30px; border: none;
            font-weight: bold; cursor: pointer;
        }

        /* --- CONTENT AREA --- */
        .main-wrapper { flex-grow: 1; position: relative; overflow-y: auto; padding: 40px; }
        .content-section { display: none; width: 100%; max-width: 1000px; margin: 0 auto; }
        .content-section.active { display: block; animation: fadeIn 0.4s ease; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Shared UI Elements */
        .card { background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 0 25px rgba(0,0,0,0.08); margin-bottom: 20px; }
        h2 { background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 28px; margin-bottom: 20px; }
        .form-row { display: flex; gap: 15px; margin-bottom: 15px; }
        input, select { flex: 1; padding: 12px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; }
        button.primary-btn { background: var(--primary-gradient); color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        
        /* Table Styles */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #f4f4f4; padding: 12px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #eee; font-size: 14px; }

        /* Stock Specific */
        .low-stock { border-left: 8px solid #ff4444; }
        .ok-stock { border-left: 8px solid #28a745; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="ptimg"><img src="PTlogo.jpeg" alt="Logo"></div>
        <br>
        <a onclick="showSection('home')" id="link-home">Home</a>
        <a onclick="showSection('employees')" id="link-employees">Employees</a>
        <a onclick="showSection('attendance')" id="link-attendance">Attendance</a>
        <a onclick="showSection('stock')" id="link-stock">Stock</a>
        <a onclick="showSection('customers')" id="link-customers">Customers</a>
        <a onclick="showSection('accounts')" id="link-accounts">Accounts</a>
        <a onclick="showSection('expenses')" id="link-expenses">Expenses</a>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <div class="main-wrapper">
        
        <section id="home" class="content-section">
            <div class="card">
                <h2>Dashboard Summary</h2>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                    <div class="card" style="background: #e1f5fe; text-align: center;">
                        <h3 id="stat-orders">0</h3><p>Active Orders</p>
                    </div>
                    <div class="card" style="background: #e8f5e9; text-align: center;">
                        <h3 id="stat-attendance">0</h3><p>Staff Present</p>
                    </div>
                    <div class="card" style="background: #fff3e0; text-align: center;">
                        <h3 id="stat-stock">0</h3><p>Low Stock Items</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="stock" class="content-section">
            <div class="card">
                <h2>Stock Management</h2>
                <div class="form-row">
                    <input type="text" id="stockItem" placeholder="Select item from dropdown" readonly>
                    <input type="number" id="stockAvl" placeholder="Available">
                    <input type="number" id="stockReq" placeholder="Required">
                </div>
                <button class="primary-btn" onclick="saveStock()">Place Order</button>
                <div id="stockList" style="margin-top:20px;"></div>
            </div>
        </section>

        <section id="accounts" class="content-section">
            <div class="card">
                <h2>Accounts Ledger</h2>
                <div class="form-row">
                    <input type="text" id="accAgent" placeholder="Agent Name">
                    <input type="number" id="accAmt" placeholder="Amount">
                </div>
                <button class="primary-btn" onclick="saveAccount()">Save Entry</button>
                <table>
                    <thead><tr><th>Agent</th><th>Amount</th><th>Status</th><th>Actions</th></tr></thead>
                    <tbody id="accTableBody"></tbody>
                </table>
            </div>
        </section>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, addDoc, onSnapshot, query, orderBy, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIG (Nee kudutha adhae config)
        const firebaseConfig = {
            apiKey: "AIzaSyC3yLs6Zx_JuCtGIPVKSrY9gse3ZkAi3Fs",
            authDomain: "printech-c101a.firebaseapp.com",
            projectId: "printech-c101a",
            storageBucket: "printech-c101a.firebasestorage.app",
            messagingSenderId: "629188473697",
            appId: "1:629188473697:web:1ca8e7a5294eb9ec830b20"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- NAVIGATION LOGIC ---
        window.showSection = (id) => {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('link-' + id).classList.add('active');
        };

        // --- AUTH CHECK ---
        const user = JSON.parse(sessionStorage.getItem("loggedUser"));
        if(!user) { window.location.href = "login.html"; }
        const userName = user ? (user.user || user.name) : "Admin";

        // --- STOCK LOGIC ---
        window.saveStock = async () => {
            const item = document.getElementById("stockItem").value;
            const avl = document.getElementById("stockAvl").value;
            const req = document.getElementById("stockReq").value;
            if(!item || !avl) return alert("Fill details machi!");
            
            await addDoc(collection(db, "StockData"), {
                item, avl: parseInt(avl), req: parseInt(req),
                addedBy: userName, timestamp: new Date(), done: false
            });
            alert("Stock Added!");
        };

        // REAL-TIME STOCK SYNC
        onSnapshot(query(collection(db, "StockData"), orderBy("timestamp", "desc")), (snap) => {
            const container = document.getElementById("stockList");
            container.innerHTML = "";
            snap.forEach(docSnap => {
                const s = docSnap.data();
                container.innerHTML += `<div class="card ${s.avl < s.req ? 'low-stock' : 'ok-stock'}">
                    <b>${s.item}</b> - Avl: ${s.avl} / Req: ${s.req} <br>
                    <small>By: ${s.addedBy}</small>
                </div>`;
            });
        });

        // Initial view
        showSection('home');

        window.logout = () => { sessionStorage.clear(); window.location.href = "login.html"; };

    </script>
</body>
</html>